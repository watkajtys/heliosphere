<!DOCTYPE html>
<html>
<head>
    <title>Simple Solar Composite Tuner</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; margin: 20px; background: #1a1a1a; color: #eee; }
        .container { max-width: 1200px; margin: 0 auto; text-align: center;}
        .controls { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: inline-block; }
        .control-group { margin-bottom: 15px; text-align: left; }
        .control-group label { display: block; margin-bottom: 10px; font-size: 16px; }
        .slider { width: 400px; accent-color: #50fa7b; }
        .value-display { font-weight: bold; color: #50fa7b; padding: 2px 6px; background: #444; border-radius: 4px; }
        img { max-width: 100%; border: 2px solid #555; border-radius: 4px; background: #000; margin-top: 20px; }
        h1 { color: #ffb86c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simple Solar Composite Tuner</h1>

        <div class="controls">
            <div class="control-group">
                <label for="compositeRadiusSlider">Composite Radius: <span id="compositeRadiusValue" class="value-display">600</span>px</label>
                <input type="range" id="compositeRadiusSlider" class="slider" min="400" max="800" value="600" step="5">
            </div>
            <div class="control-group">
                <label for="featherRadiusSlider">Feather Radius: <span id="featherRadiusValue" class="value-display">40</span>px</label>
                <input type="range" id="featherRadiusSlider" class="slider" min="0" max="150" value="40" step="1">
            </div>
            <div class="control-group">
                <label for="brightnessSlider">Brightness: <span id="brightnessValue" class="value-display">1.0</span></label>
                <input type="range" id="brightnessSlider" class="slider" min="0" max="2" value="1" step="0.1">
            </div>
            <div class="control-group">
                <label for="saturationSlider">Saturation: <span id="saturationValue" class="value-display">1.0</span></label>
                <input type="range" id="saturationSlider" class="slider" min="0" max="4" value="1" step="0.1">
            </div>
            <div class="control-group">
                <label for="hueSlider">Hue: <span id="hueValue" class="value-display">0</span></label>
                <input type="range" id="hueSlider" class="slider" min="0" max="360" value="0" step="1">
            </div>
        </div>

        <div class="image-container">
            <img id="compositeImg" src="/composite-image?compositeRadius=600&featherRadius=40&brightness=1&saturation=1&hue=0" alt="Loading composite image...">
        </div>
    </div>

    <script>
        const compositeRadiusSlider = document.getElementById('compositeRadiusSlider');
        const compositeRadiusValue = document.getElementById('compositeRadiusValue');
        const featherRadiusSlider = document.getElementById('featherRadiusSlider');
        const featherRadiusValue = document.getElementById('featherRadiusValue');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const brightnessValue = document.getElementById('brightnessValue');
        const saturationSlider = document.getElementById('saturationSlider');
        const saturationValue = document.getElementById('saturationValue');
        const hueSlider = document.getElementById('hueSlider');
        const hueValue = document.getElementById('hueValue');
        const compositeImg = document.getElementById('compositeImg');

        function updateImage() {
            const compositeRadius = compositeRadiusSlider.value;
            const featherRadius = featherRadiusSlider.value;
            const brightness = brightnessSlider.value;
            const saturation = saturationSlider.value;
            const hue = hueSlider.value;

            compositeRadiusValue.textContent = compositeRadius;
            featherRadiusValue.textContent = featherRadius;
            brightnessValue.textContent = parseFloat(brightness).toFixed(1);
            saturationValue.textContent = parseFloat(saturation).toFixed(1);
            hueValue.textContent = hue;

            // Add a timestamp to the URL to force the browser to reload the image
            const timestamp = Date.now();
            compositeImg.src = `/composite-image?compositeRadius=${compositeRadius}&featherRadius=${featherRadius}&brightness=${brightness}&saturation=${saturation}&hue=${hue}&t=${timestamp}`;
        }

        // Update the text display in real-time as the slider moves
        compositeRadiusSlider.addEventListener('input', () => {
            compositeRadiusValue.textContent = compositeRadiusSlider.value;
        });
        featherRadiusSlider.addEventListener('input', () => {
            featherRadiusValue.textContent = featherRadiusSlider.value;
        });
        brightnessSlider.addEventListener('input', () => {
            brightnessValue.textContent = parseFloat(brightnessSlider.value).toFixed(1);
        });
        saturationSlider.addEventListener('input', () => {
            saturationValue.textContent = parseFloat(saturationSlider.value).toFixed(1);
        });
        hueSlider.addEventListener('input', () => {
            hueValue.textContent = hueSlider.value;
        });

        // Update the image only when the user has finished changing the value (releases the slider)
        // This prevents sending too many requests to the server.
        compositeRadiusSlider.addEventListener('change', updateImage);
        featherRadiusSlider.addEventListener('change', updateImage);
        brightnessSlider.addEventListener('change', updateImage);
        saturationSlider.addEventListener('change', updateImage);
        hueSlider.addEventListener('change', updateImage);

        // No need for an initial call to updateImage() since the <img> tag's src is already set with default values.
    </script>
</body>
</html>
